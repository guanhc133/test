<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:reg="http://www.dangdang.com/schema/ddframe/reg"
       xmlns:job="http://www.dangdang.com/schema/ddframe/job"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.dangdang.com/schema/ddframe/reg
       http://www.dangdang.com/schema/ddframe/reg/reg.xsd
       http://www.dangdang.com/schema/ddframe/job
       http://www.dangdang.com/schema/ddframe/job/job.xsd">

    <!--配置作业注册中心，namespace的命名需要提jira工单申请zookeeper路径，规范为“标准应用名-job -->
    <reg:zookeeper id="zk-job-center"
                   namespace="middleware-test8-job"
                   base-sleep-time-milliseconds="1000"
                   max-sleep-time-milliseconds="3000"
                   session-timeout-milliseconds="6000"
                   connection-timeout-milliseconds="3000"
                   max-retries="3"
                   server-lists="localhost:2181"/>

    <!-- 定时任务执行历史数据源，用户名密码连接串会在zk申请单中回复-->
    <!--使用HikariCP连接池配置，如何使用详见  https://wiki.bestpay.com.cn/display/JCJS/bestpay-hikaricp -->
    <!--注意连接池的大小不要超过3 -->
    <bean id="hikariConfig" class="com.zaxxer.hikari.HikariConfig">
        <property name="poolName" value="springHikariCP" />
        <property name="driverClassName" value="com.mysql.jdbc.Driver" />
        <property name="minimumIdle" value="3" />
        <property name="maximumPoolSize" value="3" />
        <property name="connectionTimeout" value="5000" />
        <property name="idleTimeout" value="300000" />
        <property name="allowPoolSuspension" value="true" /> <!--这个一定要加，连接池可以更新-->
        <!--dataSourceConnection用于配置数据库用户名，密码，连接串-->
        <property name="dataSourceConnection" value="username=elasticjober;password=elasticjober;jdbcUrl=jdbc:mysql://172.17.45.16:3306/elasticjob?useUnicode=true&amp;characterEncoding=UTF-8" />
    </bean>

    <!-- 定时任务执行历史数据源 -->
    <!--使用HikariCP data source-->
    <bean id="hikariDataSource2" class="com.zaxxer.hikari.HikariDataSource" destroy-method="close">
        <constructor-arg ref="hikariConfig" />
    </bean>

    <!--
        id	String	是		作业名称
        class	String	否		作业实现类，需实现ElasticJob接口
        job-ref	String	否		作业关联的beanId，该配置优先级大于class属性配置
        registry-center-ref	String	是		注册中心Bean的引用，需引用reg:zookeeper的声明
        cron	String	是		cron表达式，用于控制作业触发时间
        sharding-total-count	int	是		作业分片总数
        sharding-item-parameters	String	否		分片序列号和参数用等号分隔，多个键值对用逗号分隔
        分片序列号从0开始，不可大于或等于作业分片总数
        如：
        0=a,1=b,2=c
        job-instance-id	String	否	defaultInstance	作业实例主键，同IP可运行实例主键不同, 但名称相同的多个作业实例
        job-parameter	String	否		作业自定义参数
        作业自定义参数，可通过传递该参数为作业调度的业务方法传参，用于实现带参数的作业
        例：每次获取的数据量、作业实例从数据库读取的主键等
        monitor-execution	boolean	否	true	监控作业运行时状态
        每次作业执行时间和间隔时间均非常短的情况，建议不监控作业运行时状态以提升效率。因为是瞬时状态，所以无必要监控。请用户自行增加数据堆积监控。并且不能保证数据重复选取，应在作业中实现幂等性。
        每次作业执行时间和间隔时间均较长的情况，建议监控作业运行时状态，可保证数据不会重复选取。
        monitor-port	int	否	-1	作业监控端口
        建议配置作业监控端口, 方便开发者dump作业信息。
        使用方法: echo “dump” | nc 127.0.0.1 9888
        max-time-diff-seconds	int	否	-1	最大允许的本机与注册中心的时间误差秒数
        如果时间误差超过配置秒数则作业启动时将抛异常
        配置为-1表示不校验时间误差
        failover	boolean	否	false	是否开启失效转移
        misfire	boolean	否	true	是否开启错过任务重新执行
        job-sharding-strategy-class	String	否		作业分片策略实现类全路径
        默认使用平均分配策略
        详情参见：作业分片策略
        description	String	否		作业描述信息
        disabled	boolean	否	false	作业是否禁止启动
        可用于部署作业时，先禁止启动，部署结束后统一启动
        overwrite	boolean	否	false	本地配置是否可覆盖注册中心配置
        如果可覆盖，每次启动作业都以本地配置为准
        job-exception-handler	String	否		扩展异常处理类
        executor-service-handler	String	否		扩展作业处理线程池类
        reconcile-interval-minutes	int	否	10	修复作业服务器不一致状态服务调度间隔时间，配置为小于1的任意值表示不执行修复
        单位：分钟
        event-trace-rdb-data-source	String	否		作业事件追踪的数据源Bean引用
    -->

    <!--<job:simple id ="repayQueryJob" class="com.bestpay.cf.instalmentmix.txn.task.RepayQueryJob"
                registry-center-ref="zk-job-center"
                cron="0 30 0/6 * * ? *"
                sharding-total-count="12"
                disabled="false"
                failover="false"
                monitor-execution="false"
                misfire="true"
                overwrite="true"
                reconcile-interval-minutes="10"
                description="还款未知查询"
                job-sharding-strategy-class="com.dangdang.ddframe.job.lite.api.strategy.impl.AverageAllocationJobShardingStrategy"
                event-trace-rdb-data-source="hikariDataSource">

    </job:simple>-->

    <job:simple id ="queryEntrustAgreementJob" class="com.bestpay.cf.instalmentmix.txn.task.QueryEntrustAgreementJob"
                registry-center-ref="zk-job-center"
                cron="0 0/1 * * * ?"
                sharding-total-count="1"
                disabled="false"
                failover="false"
                monitor-execution="false"
                misfire="true"
                overwrite="true"
                reconcile-interval-minutes="10"
                description="状态查询"
                job-sharding-strategy-class="com.dangdang.ddframe.job.lite.api.strategy.impl.RotateServerByNameJobShardingStrategy"
                event-trace-rdb-data-source="hikariDataSource2">
    </job:simple>

</beans>